#!/usr/bin/env python3
import ipaddress
import os
import subprocess
import sys

PING_ARG_NIX = "-c 1"
PING_ARG_WIN = "-n 1 -W 1"


def ping(ip_addr):
    try:
        if os.name == "nt":
            print("not implemented")
            sys.exit(0)
        else:
            online = bool(subprocess.check_call(["ping", PING_ARG_NIX, ip_addr], stdout=subprocess.DEVNULL) == 0)
    except subprocess.CalledProcessError:
        online = False
    return online


def main():
    if os.name == "nt":
        print("not implemented")
        sys.exit(0)
    try:
        net = ipaddress.ip_network(sys.argv[1], strict=False)
    except:
        print("CIDR required, e.g. 129.168.1.0/24")
    print("Pinging from {} to {}".format(net[0], net[-1]))
    for ip_addr in net.hosts():
        print("trying {}".format(ip_addr), end="\r")
        if ping(str(ip_addr)):
            print("{} online ".format(ip_addr))


if __name__ == "__main__":
    main()
